<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>C提高 | 太初有猪丶</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/qq1.jpg">
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.0812be81.css" as="style"><link rel="preload" href="/assets/js/app.21054e1e.js" as="script"><link rel="preload" href="/assets/js/2.331c82e1.js" as="script"><link rel="preload" href="/assets/js/7.b0b60adb.js" as="script"><link rel="prefetch" href="/assets/js/3.741d2244.js"><link rel="prefetch" href="/assets/js/4.3901bc35.js"><link rel="prefetch" href="/assets/js/5.d4b240f0.js"><link rel="prefetch" href="/assets/js/6.51a4035c.js"><link rel="prefetch" href="/assets/js/8.ae47c6e5.js"><link rel="prefetch" href="/assets/js/9.66ea9da6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0812be81.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/qq1.jpg" alt="太初有猪丶" class="logo"> <span class="site-name can-hide">太初有猪丶</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="C基础" class="dropdown-title"><span class="title">C基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Cbasics/Cbasics1/C基础（上）.html" class="nav-link">
  C基础（上）
</a></li><li class="dropdown-item"><!----> <a href="/Cbasics/Cbasics2/C基础（下）.html" class="nav-link">
  C基础（下）
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="C提高" class="dropdown-title"><span class="title">C提高</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Chigh/Chigh/C提高0615.html" class="nav-link">
  C提高
</a></li><li class="dropdown-item"><!----> <a href="/Chigh/datastructure/数据结构0615.html" class="nav-link">
  数据结构
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="C基础" class="dropdown-title"><span class="title">C基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Cbasics/Cbasics1/C基础（上）.html" class="nav-link">
  C基础（上）
</a></li><li class="dropdown-item"><!----> <a href="/Cbasics/Cbasics2/C基础（下）.html" class="nav-link">
  C基础（下）
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="C提高" class="dropdown-title"><span class="title">C提高</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Chigh/Chigh/C提高0615.html" class="nav-link">
  C提高
</a></li><li class="dropdown-item"><!----> <a href="/Chigh/datastructure/数据结构0615.html" class="nav-link">
  数据结构
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>C提高</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_1-内存分布" class="sidebar-link">1. 内存分布</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_1-1-内存区域" class="sidebar-link">1.1 内存区域</a></li><li class="sidebar-sub-header"><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_1-2-内存四区简述" class="sidebar-link">1.2 内存四区简述</a></li><li class="sidebar-sub-header"><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_1-3-三种内存操作函数" class="sidebar-link">1.3 三种内存操作函数</a></li><li class="sidebar-sub-header"><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_1-4-全局区-静态区-数据区" class="sidebar-link">1.4 全局区/静态区/数据区</a></li><li class="sidebar-sub-header"><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_1-5-全局变量与静态变量" class="sidebar-link">1.5 全局变量与静态变量</a></li><li class="sidebar-sub-header"><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_1-6-伪常量" class="sidebar-link">1.6 伪常量</a></li><li class="sidebar-sub-header"><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_1-7-函数调用模型" class="sidebar-link">1.7 函数调用模型</a></li><li class="sidebar-sub-header"><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_1-8-栈的生长方向与内存存储方式" class="sidebar-link">1.8 栈的生长方向与内存存储方式</a></li></ul></li><li><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_2-指针进阶" class="sidebar-link">2. 指针进阶</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_2-1-空指针与野指针" class="sidebar-link">2.1 空指针与野指针</a></li><li class="sidebar-sub-header"><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_2-2-指针步长的意义" class="sidebar-link">2.2 指针步长的意义</a></li><li class="sidebar-sub-header"><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_2-3-指针的间接赋值" class="sidebar-link">2.3 指针的间接赋值</a></li><li class="sidebar-sub-header"><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_2-4-指针做函数参数输入输出特性" class="sidebar-link">2.4 指针做函数参数输入输出特性</a></li><li class="sidebar-sub-header"><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_2-5-指针易错点" class="sidebar-link">2.5 指针易错点</a></li><li class="sidebar-sub-header"><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_2-6-二级指针的输入和输出特性" class="sidebar-link">2.6 二级指针的输入和输出特性</a></li></ul></li><li><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_3-位运算" class="sidebar-link">3. 位运算</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_3-1-存数据" class="sidebar-link">3.1 存数据</a></li><li class="sidebar-sub-header"><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_3-2-取数据" class="sidebar-link">3.2 取数据</a></li><li class="sidebar-sub-header"><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_3-3-位运算符" class="sidebar-link">3.3 位运算符</a></li><li class="sidebar-sub-header"><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_3-4-位移运算符" class="sidebar-link">3.4 位移运算符</a></li></ul></li><li><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_4-数组进阶" class="sidebar-link">4. 数组进阶</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_4-1-一维数组与数组名" class="sidebar-link">4.1 一维数组与数组名</a></li><li class="sidebar-sub-header"><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_4-2-数组指针" class="sidebar-link">4.2 数组指针</a></li><li class="sidebar-sub-header"><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_4-3-二维数组与数组名" class="sidebar-link">4.3 二维数组与数组名</a></li></ul></li><li><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_5-结构体进阶" class="sidebar-link">5. 结构体进阶</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_5-1-结构体的基本使用" class="sidebar-link">5.1 结构体的基本使用</a></li><li class="sidebar-sub-header"><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_5-2-结构体赋值问题" class="sidebar-link">5.2 结构体赋值问题</a></li><li class="sidebar-sub-header"><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_5-3-结构体偏移" class="sidebar-link">5.3 结构体偏移</a></li></ul></li><li><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_6-文件操作" class="sidebar-link">6. 文件操作</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_6-1-文件的简述" class="sidebar-link">6.1 文件的简述</a></li><li class="sidebar-sub-header"><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_6-2-文件指针" class="sidebar-link">6.2 文件指针</a></li><li class="sidebar-sub-header"><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_6-3-文件的开关" class="sidebar-link">6.3 文件的开关</a></li><li class="sidebar-sub-header"><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_6-4-按字符、行读写" class="sidebar-link">6.4 按字符、行读写</a></li><li class="sidebar-sub-header"><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_6-5-按格式化、按块读写" class="sidebar-link">6.5 按格式化、按块读写</a></li><li class="sidebar-sub-header"><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_6-6-文件指针" class="sidebar-link">6.6 文件指针</a></li></ul></li><li><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_7-函数指针" class="sidebar-link">7. 函数指针</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_7-1-函数指针的定义" class="sidebar-link">7.1 函数指针的定义</a></li><li class="sidebar-sub-header"><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_7-2-函数指针数组" class="sidebar-link">7.2 函数指针数组</a></li><li class="sidebar-sub-header"><a href="/Chigh/Chigh/C%E6%8F%90%E9%AB%980615.html#_8-3-回调函数" class="sidebar-link">8.3 回调函数</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="c提高"><a href="#c提高" class="header-anchor">#</a> C提高</h1> <h2 id="_1-内存分布"><a href="#_1-内存分布" class="header-anchor">#</a> 1. 内存分布</h2> <h3 id="_1-1-内存区域"><a href="#_1-1-内存区域" class="header-anchor">#</a> 1.1 内存区域</h3> <ul><li>程序运行前
<ul><li>代码区</li> <li>全局区/静态区/数据区</li></ul></li> <li>程序运行后
<ul><li>stack栈区</li> <li>heap堆区</li></ul></li></ul> <h3 id="_1-2-内存四区简述"><a href="#_1-2-内存四区简述" class="header-anchor">#</a> 1.2 内存四区简述</h3> <ul><li><p>代码区</p> <ul><li>存放程序的二进制代码</li> <li>只读</li> <li>共享，比如游戏多开，代码区不会有两段游戏代码</li></ul></li> <li><p>stack栈区</p> <ul><li><p>特性</p> <ul><li>栈是一种先进后出的内存结构，由编译器自动分配释放数据</li> <li>主要存放函数的形式参数值、局部变量等</li> <li>生命周期为函数运行开始至结束，函数使用完毕立即释放</li> <li>栈空间较小，不适合将大量数据存放在栈中</li></ul></li> <li><p>注意事项：不要返回局部变量的地址</p> <ul><li><p>返回非字符串的地址时，不同的编辑器输出结果不一样，vs会保护一次</p></li> <li><p>返回字符串的地址时，无法在栈区释放后确定字符串的长度，vs不保护</p></li></ul></li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token operator">*</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>a<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> <span class="token operator">*</span> p <span class="token operator">=</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;a = %d\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">*</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;a = %d\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">*</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token punctuation">}</span>
<span class="token comment">//第一次输出10，其余乱码</span>
</code></pre></div><div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">char</span> <span class="token operator">*</span> <span class="token function">getString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">char</span> str<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;hello world&quot;</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> str<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">char</span> <span class="token operator">*</span> p <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	p <span class="token operator">=</span> <span class="token function">getString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;p = %s\n&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//输出乱码</span>
</code></pre></div></li> <li><p>堆区</p> <ul><li><p>特性</p> <ul><li>堆区由开发人员手动申请和释放，在释放之前，该块堆空间可一直使用</li> <li>由程序员分配和释放，若程序员不释放，程序结束时由系统回收内存</li> <li>堆空间一般没有软限制，只受限于硬件</li></ul></li> <li><p>注意事项：主调函数中没给指针分配内存，被调函数需用高级指针进行分配</p></li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token keyword">void</span> <span class="token function">allocateSpace</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> pp<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span><span class="token operator">*</span> temp <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token operator">*</span>temp <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
	pp <span class="token operator">=</span> temp<span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">*</span>pp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//输出20</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> a<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span><span class="token operator">*</span> p <span class="token operator">=</span> <span class="token operator">&amp;</span>a<span class="token punctuation">;</span>
	<span class="token function">allocateSpace</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">*</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//输出10</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//解决方式1：高级指针</span>

<span class="token keyword">void</span> <span class="token function">allocateSpace02</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> pp<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span><span class="token operator">*</span> temp <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token operator">*</span>temp <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
	<span class="token operator">*</span>pp <span class="token operator">=</span> temp<span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">*</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//输出20</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> a<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span><span class="token operator">*</span> p <span class="token operator">=</span> <span class="token operator">&amp;</span>a<span class="token punctuation">;</span>
	<span class="token function">allocateSpace02</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">*</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//输出20</span>
<span class="token punctuation">}</span>

<span class="token comment">//解决方式2：返回指针</span>
</code></pre></div></li></ul> <h3 id="_1-3-三种内存操作函数"><a href="#_1-3-三种内存操作函数" class="header-anchor">#</a> 1.3 三种内存操作函数</h3> <ul><li><p>malloc()</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> num_bytes<span class="token punctuation">)</span>
</code></pre></div><ul><li>开辟分配长度为num_bytes字节的内存块</li> <li>分配成功返回被分配的内存地址，失败返回NULL</li></ul></li> <li><p>calloc()</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">calloc</span><span class="token punctuation">(</span><span class="token keyword">int</span> num_elems<span class="token punctuation">,</span> <span class="token keyword">int</span> elem_size<span class="token punctuation">)</span>
</code></pre></div><ul><li><p>两个参数，为具有num_elems个长度为elem_size元素的数组开辟分配内存</p></li> <li><p>分配成功返回被分配的内存地址，失败返回NULL</p></li> <li><p>比起malloc()来，会将分配的内存块里的内容自动初始化为0</p></li></ul></li> <li><p>realloc()</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">realloc</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>mem_address<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> newsize<span class="token punctuation">)</span>
</code></pre></div><ul><li>修改malloc()申请的地址mem_address所指内存区域的大小为newsize长度</li> <li>分配成功返回被分配的内存地址，失败返回NULL</li> <li>扩大时
<ul><li>若原地址后的空闲空间足够大，则在原地址的基础上重新指定其大小，不会初始化为0，原数据不变，原地址和修改后的地址一致</li> <li>若原地址后的空闲空间不够大，则新分配一个地址（不会初始化为0）原数据复制过去后原地址被释放，原地址和修改后的地址不一致</li></ul></li> <li>缩小时
<ul><li>缩小到剩下几个只能访问几个，多访问会越界报错</li></ul></li></ul></li></ul> <h3 id="_1-4-全局区-静态区-数据区"><a href="#_1-4-全局区-静态区-数据区" class="header-anchor">#</a> 1.4 全局区/静态区/数据区</h3> <ul><li>特性
<ul><li>数据区存储全局变量、静态变量、常量，该区变量在程序运行期间一直存在</li> <li>编译器自动管理该区内存</li> <li>已初始化的非0数据放在data段，未初始化和初始化为0的数据放到bss段</li> <li>bss段程序执行前就会自动清0，所以未初始化的全局、静态变量会被置为0</li> <li>rodata区为只读数据段，存放常量和只读全局数据</li></ul></li></ul> <h3 id="_1-5-全局变量与静态变量"><a href="#_1-5-全局变量与静态变量" class="header-anchor">#</a> 1.5 全局变量与静态变量</h3> <ul><li>详见C基础8.2与8.3</li></ul> <h3 id="_1-6-伪常量"><a href="#_1-6-伪常量" class="header-anchor">#</a> 1.6 伪常量</h3> <ul><li><p>关键字const修饰的变量</p> <ul><li>修饰全局变量为常量时，不可通过指针间接修改其值，报错</li> <li>修饰局部变量为常量时，可通过指针间接修改其值</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">const</span> <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">//全局常量存放到常量区，收到常量区的保护</span>

<span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> <span class="token operator">*</span> p <span class="token operator">=</span> <span class="token operator">&amp;</span>a<span class="token punctuation">;</span>
	<span class="token operator">*</span>p <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>  <span class="token comment">//间接修改语法通过，运行报错</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;a = %d &quot;</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span> 

	<span class="token keyword">const</span> <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">//b分配到了栈上,可以通过间接方式对其进行修改</span>
	<span class="token keyword">int</span> <span class="token operator">*</span> p2 <span class="token operator">=</span> <span class="token operator">&amp;</span>b<span class="token punctuation">;</span>
	<span class="token operator">*</span>p2 <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;b = %d\n&quot;</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//间接修改成功</span>

</code></pre></div></li></ul> <h3 id="_1-7-函数调用模型"><a href="#_1-7-函数调用模型" class="header-anchor">#</a> 1.7 函数调用模型</h3> <ul><li><p>宏函数</p> <ul><li>宏函数和宏常量都是利用#define定义出来的内容</li> <li>在项目中经常把一些短小而又频繁使用的函数写成宏函数</li> <li>以空间换时间，可以提升程序的效率</li> <li>宏函数通常需要加括号，保证运算的完整，不加会导致优先级问题</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property">#<span class="token directive keyword">define</span> MYADD(x,y)  (x + y) </span>

<span class="token comment">//普通函数下的a、b都要进行入栈，函数执行后出栈</span>
<span class="token keyword">int</span>  <span class="token function">myAdd</span><span class="token punctuation">(</span><span class="token keyword">int</span> a <span class="token punctuation">,</span><span class="token keyword">int</span> b<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//宏函数在编译阶段就替换源码</span>
<span class="token comment">//而没有普通函数入栈出栈的开销，以空间换时间</span>
<span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;a + b = %d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">MYADD</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
<span class="token comment">//输出300</span>
</code></pre></div></li> <li><p>函数调用流程与调用惯例</p> <ul><li>函数的调用方和被调用方对于如何调用须有一个明确约定，即调用惯例</li></ul> <table><thead><tr><th>调用惯例</th> <th>出栈方</th> <th>参数传递</th> <th>名字修饰（不用记）</th></tr></thead> <tbody><tr><td>cdecl</td> <td>主调函数</td> <td>从右至左参数入栈</td> <td>下划线+函数名</td></tr> <tr><td>stdcall</td> <td>函数本身</td> <td>从右至左参数入栈</td> <td>下划线+函数名+@+参数字节数</td></tr> <tr><td>fastcall</td> <td>函数本身</td> <td>前两个参数由寄存器传递，</td> <td>@+函数名+@+参数的字节数</td></tr> <tr><td>pascal</td> <td>函数本身</td> <td>从左至右参数入栈</td> <td>较为复杂，参见相关文档</td></tr></tbody></table></li></ul> <h3 id="_1-8-栈的生长方向与内存存储方式"><a href="#_1-8-栈的生长方向与内存存储方式" class="header-anchor">#</a> 1.8 栈的生长方向与内存存储方式</h3> <ul><li><p>栈的生长方向</p> <ul><li>栈的模型如同一个杯子，杯子底即栈底为高地址，杯子顶即栈顶为低地址</li> <li>先分配的变量地址高，后分配的变量地址低（先进后出）</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> d <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">;</span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> 
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//输出结果a&gt;b&gt;c&gt;d</span>
</code></pre></div></li> <li><p>内存存储方式</p> <ul><li>小端模式，普通家用机器，高位字节数据保存在内存的高地址中</li> <li>大端模式，大型服务器、设备，高位字节数据保存在内存的低地址中</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">0x11223344</span><span class="token punctuation">;</span>  <span class="token comment">//左边叫做高位右边叫低位</span>
	<span class="token keyword">char</span> <span class="token operator">*</span> p <span class="token operator">=</span> <span class="token operator">&amp;</span>a<span class="token punctuation">;</span> <span class="token comment">//char * 改变指针步长，一次跳一个字节 </span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%x\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">*</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">//输出44  低地址存低位字节</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%x\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span>p<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%x\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span>p<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%x\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span>p<span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//输出11  高地址存高位字节</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h2 id="_2-指针进阶"><a href="#_2-指针进阶" class="header-anchor">#</a> 2. 指针进阶</h2> <h3 id="_2-1-空指针与野指针"><a href="#_2-1-空指针与野指针" class="header-anchor">#</a> 2.1 空指针与野指针</h3> <ul><li><p>空指针</p> <ul><li>特殊的指针变量，表示不指向任何东西</li> <li>指针变量创建的时候，可以初始化为NULL</li> <li>不要对空指针进行解引用操作</li> <li>空指针可以重复free</li></ul></li> <li><p>野指针</p> <ul><li>野指针指向一个已释放的内存或者未申请过的内存空间</li> <li>不要对野指针进行解引用操作</li> <li>野指针不能重复free</li> <li>常见的野指针
<ul><li>指针变量未初始化</li> <li>释放堆区的指针后未置为空</li> <li>指针操作超越了变量的作用域</li></ul></li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span><span class="token operator">*</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> 
	<span class="token keyword">int</span> <span class="token operator">*</span> p <span class="token operator">=</span> <span class="token operator">&amp;</span>a<span class="token punctuation">;</span> 
	<span class="token keyword">return</span> p<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">//1 指针变量未初始化</span>
	<span class="token keyword">int</span> <span class="token operator">*</span> p1<span class="token punctuation">;</span>
	<span class="token comment">//printf(&quot;%d\n&quot;, *p1);</span>

	<span class="token comment">//2 指针释放后未置空</span>
	<span class="token keyword">int</span> <span class="token operator">*</span> p2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token operator">*</span>p2 <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
	<span class="token function">free</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">*</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//乱码 已经释放了</span>

	<span class="token comment">//3 指针操作超越变量作用域</span>
	<span class="token keyword">int</span> <span class="token operator">*</span> p3 <span class="token operator">=</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">*</span>p3<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h3 id="_2-2-指针步长的意义"><a href="#_2-2-指针步长的意义" class="header-anchor">#</a> 2.2 指针步长的意义</h3> <ul><li><p>作用</p> <ul><li>指针变量+1后跳跃字节数量不同</li> <li>解引用的时候，取出字节数量不同</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">char</span> <span class="token operator">*</span> p <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> p<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">int</span> <span class="token operator">*</span> p1 <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> p1<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> p1 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//2、解引用时候  取多少字节数</span>
<span class="token keyword">void</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">//1024字节</span>
	<span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>  <span class="token comment">//4字节</span>
	<span class="token function">memcpy</span><span class="token punctuation">(</span>buf<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>a<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">char</span> <span class="token operator">*</span> p <span class="token operator">=</span> buf<span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span>  <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>p<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>offsetof()函数</p> <ul><li>需要头文件&lt;stddef.h&gt;</li> <li>自定义数据找偏移量</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token comment">//找到结构体中d属性的位置以及打印该属性</span>
<span class="token keyword">struct</span> <span class="token class-name">Person</span>
<span class="token punctuation">{</span>
	<span class="token keyword">char</span> a<span class="token punctuation">;</span> <span class="token comment">//0 ~ 3</span>
	<span class="token keyword">int</span> b<span class="token punctuation">;</span>  <span class="token comment">//4 ~ 7</span>
	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">//8 ~ 71</span>
	<span class="token keyword">int</span> d<span class="token punctuation">;</span>  <span class="token comment">//72 ~ 75</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">test03</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">struct</span> <span class="token class-name">Person</span>  p <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">&quot;hello world&quot;</span><span class="token punctuation">,</span> <span class="token number">10000</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token comment">//通过函数寻找自定义数据类型找偏移量</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">offsetof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">Person</span><span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//打印d的数字</span>
    <span class="token comment">//用char*跳转72字节，用（int*）强转打印整型</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;d = %d\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>p <span class="token operator">+</span> <span class="token function">offsetof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">Person</span><span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h3 id="_2-3-指针的间接赋值"><a href="#_2-3-指针的间接赋值" class="header-anchor">#</a> 2.3 指针的间接赋值</h3> <ul><li><p>间接赋值成立的条件</p> <ul><li>两个变量（普通变量+指针变量） / (实参+形参)</li> <li>建立关系</li> <li>通过*操作指针指向的内存</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">changeValue</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span>p<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token operator">*</span>p <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> <span class="token operator">*</span> p <span class="token operator">=</span> <span class="token operator">&amp;</span>a<span class="token punctuation">;</span>
	<span class="token operator">*</span>p <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;a = %d\n&quot;</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//通过实参和形参进行间接赋值</span>
	<span class="token keyword">int</span> a2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">changeValue</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>a2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;a2 = %d\n&quot;</span><span class="token punctuation">,</span> a2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>提前知道变量的地址编号，也可以修改内存空间进行间接赋值</p> <ul><li>需要修改配置，配置属性-连接器-高级-联机地址否</li></ul></li></ul> <h3 id="_2-4-指针做函数参数输入输出特性"><a href="#_2-4-指针做函数参数输入输出特性" class="header-anchor">#</a> 2.4 指针做函数参数输入输出特性</h3> <ul><li>输入特性：主调函数分配内存，被调函数使用</li> <li>输出特性：被调函数分配内存，主调函数使用</li> <li>只能在堆区进行，栈区函数结束就回收了</li></ul> <h3 id="_2-5-指针易错点"><a href="#_2-5-指针易错点" class="header-anchor">#</a> 2.5 指针易错点</h3> <ul><li><p>指针越界</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;zhangtao&quot;</span><span class="token punctuation">;</span>  <span class="token comment">//字符串内8个字符与一个“\0”</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;buf:%s\n&quot;</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>返回局部变量的地址</p> <div class="language-c extra-class"><pre class="language-c"><code>
<span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">char</span> str<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;abcdedsgads&quot;</span><span class="token punctuation">;</span> <span class="token comment">//栈区，</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;getString - str = %s\n&quot;</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> str<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">char</span> <span class="token operator">*</span> str <span class="token operator">=</span> <span class="token function">getString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;test - str = %s\n&quot;</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>局部变量是存在栈区的，函数结束栈区释放，数据就没了，接收到地址变成野指针</li></ul></li> <li><p>同一块内存释放多次</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">test03</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>p <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">free</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">free</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>释放后变野指针，野指针不能多次释放</li> <li>释放后置空变空指针，空指针可以</li></ul></li> <li><p>释放偏移后的指针</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">test04</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">char</span> str<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;hello world&quot;</span><span class="token punctuation">;</span>
	<span class="token keyword">char</span> <span class="token operator">*</span>p <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token operator">*</span>p <span class="token operator">=</span> str<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token operator">++</span>p<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">free</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>要么就修改代码，创建临时变量pp指向p，然后对pp进行操作，操作完释放p</li> <li>要么就p--回去，再释放p</li></ul></li></ul> <h3 id="_2-6-二级指针的输入和输出特性"><a href="#_2-6-二级指针的输入和输出特性" class="header-anchor">#</a> 2.6 二级指针的输入和输出特性</h3> <ul><li></li></ul> <h2 id="_3-位运算"><a href="#_3-位运算" class="header-anchor">#</a> 3. 位运算</h2> <h3 id="_3-1-存数据"><a href="#_3-1-存数据" class="header-anchor">#</a> 3.1 存数据</h3> <ul><li>在计算机中，数据有三种表现形式，分别为：原码、反码、补码</li> <li>计算机存放数据都是用补码形式</li> <li>数据的存储
<ul><li>无符号数以及有符号数的正数，源码=反码=补码</li> <li>符号数、负数，原码取反（不包括符号位）=反码，反码+1=补码</li></ul></li> <li>补码的意义
<ul><li>统一了0的编码</li> <li>让减法运算能正确运行</li></ul></li></ul> <h3 id="_3-2-取数据"><a href="#_3-2-取数据" class="header-anchor">#</a> 3.2 取数据</h3> <ul><li>无符号取
<ul><li>原码=反码=补码，直接输出</li> <li>程序中的八进制和十六进制数据，不需考虑正负，当成无符号数进行存取</li></ul></li> <li>有符号取
<ul><li>高位是0，正数，原码=反码=补码，直接输出</li> <li>高位是1，负数，符号位不变，其余位取反+1</li></ul></li></ul> <h3 id="_3-3-位运算符"><a href="#_3-3-位运算符" class="header-anchor">#</a> 3.3 位运算符</h3> <ul><li><p>对数据的补码按位取反，~，对每个二进制位取反，1&gt;0，0&gt;1</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> number <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;~number : %d\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">~</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//输出-3</span>

	<span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">~</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//输出1</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>对数据的补码按位与&amp;，同真为真，其余为假</p> <ul><li>与1进行&amp;运算，判断一个数的奇偶性，结果为1则为奇数</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> number <span class="token operator">=</span> <span class="token number">332</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>number <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d偶数\n&quot;</span><span class="token punctuation">,</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d奇数\n&quot;</span><span class="token punctuation">,</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
    <span class="token comment">//输出332偶数</span>

	<span class="token comment">//number = number &amp; 0;</span>
	number <span class="token operator">&amp;=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;number:%d\n&quot;</span><span class="token punctuation">,</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//输出0</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>对数据的补码按位或，|，同假为假，其余为真</p> <ul><li>让指定位置变1，一般linux中修改可读、可写、执行</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">test03</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> num1 <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> num2 <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;num1 | num2 = %d\n&quot;</span><span class="token punctuation">,</span> num1 <span class="token operator">|</span> num2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//输出7</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>对数据的补码按位异或，^，相同为假，不同为真</p> <ul><li>交换两个变量值</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">test04</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> num1 <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> num2 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;num1:%d num2:%d\n&quot;</span><span class="token punctuation">,</span> num1<span class="token punctuation">,</span> num2<span class="token punctuation">)</span><span class="token punctuation">;</span>

	num1 <span class="token operator">=</span> num1 <span class="token operator">^</span> num2<span class="token punctuation">;</span>
	num2 <span class="token operator">=</span> num1 <span class="token operator">^</span> num2<span class="token punctuation">;</span>
	num1 <span class="token operator">=</span> num1 <span class="token operator">^</span> num2<span class="token punctuation">;</span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;num1:%d num2:%d\n&quot;</span><span class="token punctuation">,</span>num1<span class="token punctuation">,</span>num2<span class="token punctuation">)</span><span class="token punctuation">;</span>
   
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h3 id="_3-4-位移运算符"><a href="#_3-4-位移运算符" class="header-anchor">#</a> 3.4 位移运算符</h3> <ul><li><p>左移，&lt;&lt;，对数据的补码向左移动</p> <ul><li>逻辑移位，左端移出，右端补0</li> <li>负数左移，有可能变成正数</li></ul></li> <li><p>右移，&gt;&gt;，对数据的补码向右移动</p> <ul><li>算数移位，左端补齐的是最高位的符号位，右端移出</li> <li>负数右移，肯定还是负数</li></ul> <div class="language-c extra-class"><pre class="language-c"><code>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
 
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span>
<span class="token punctuation">{</span>   
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0x8000000f</span><span class="token punctuation">;</span> <span class="token comment">//这里的0x8000000f为int型数据的补码形式</span>
    <span class="token keyword">int</span> j <span class="token operator">=</span> i <span class="token operator">&gt;&gt;</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">//右移是算术移位，左端补齐的是符号位</span>
    <span class="token keyword">int</span> k <span class="token operator">=</span> i <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//左移是逻辑移位，右端补0</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d %x\n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//-2147483633 8000000f</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d %x\n&quot;</span><span class="token punctuation">,</span> j<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//-268435455 f0000001</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d %x\n&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//30 1e</span>
 
    i <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">9</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d %x\n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//-9 fffffff7</span>
    i <span class="token operator">=</span> <span class="token number">0xfffffff7</span><span class="token punctuation">;</span>
    j <span class="token operator">=</span> i <span class="token operator">&gt;&gt;</span> <span class="token number">3</span><span class="token punctuation">;</span>
    k <span class="token operator">=</span> i <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d %x\n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//-2 fffffff7</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d %x\n&quot;</span><span class="token punctuation">,</span> j<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//-2 fffffffe</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d %x\n&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//-18 ffffffee</span>
 
 
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h2 id="_4-数组进阶"><a href="#_4-数组进阶" class="header-anchor">#</a> 4. 数组进阶</h2> <h3 id="_4-1-一维数组与数组名"><a href="#_4-1-一维数组与数组名" class="header-anchor">#</a> 4.1 一维数组与数组名</h3> <ul><li><p>数组名</p> <ul><li><p>数组名是一个地址，为数组首个元素的地址</p></li> <li><p>数组名是指针常量，指针指向的值可以改，指针的指向不能改</p></li> <li><p>数组名是不是指向数组中第一个元素的指针，虽然可以这么使用</p></li></ul></li> <li><p>数组名不能当指针用的两种情景</p> <ul><li>对数组名进行sizeof()操作</li> <li>对数组名取地址，为数组指针，步长为数组长度</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">printArray</span><span class="token punctuation">(</span> <span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">,</span> <span class="token keyword">int</span> len<span class="token punctuation">)</span> 
<span class="token comment">//int arr[]==int * arr，前者可读性高</span>
    
<span class="token punctuation">{</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d&quot;</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span>arr <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//输出2</span>

	<span class="token comment">//sizeof数组名时，统计是整个数组的大小</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;sizeof(arr) = %d\n&quot;</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//对数组名取地址时，步长为数组长度</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>arr <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//相当于数组也是一种变量</span>
    <span class="token comment">//开辟了一块内存空间，类型为int数组</span>
    <span class="token comment">//变量名为arr，内容为数组arr首元素的地址</span>

    <span class="token keyword">int</span> <span class="token operator">*</span> p <span class="token punctuation">;</span>
    p<span class="token operator">=</span>arr<span class="token punctuation">;</span> <span class="token comment">//即是将内容赋值给了p</span>
    
	<span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printArray</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>数组下标可以为负数</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token operator">*</span> p <span class="token operator">=</span> arr<span class="token punctuation">;</span> 
    p <span class="token operator">=</span> p <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;p[-1] = %d\n&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//上述代码等价于</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;p[-1] = %d\n&quot;</span><span class="token punctuation">,</span>  <span class="token operator">*</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h3 id="_4-2-数组指针"><a href="#_4-2-数组指针" class="header-anchor">#</a> 4.2 数组指针</h3> <ul><li><p>数组指针的定义方式</p> <ul><li>先定义出数组的类型，再定义数组指针变量</li> <li>先定义数组指针的类型，再定义数组指针变量</li> <li>直接定义数组指针变量</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token comment">//1、先定义出数组的类型，再定义数组指针变量</span>
<span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token keyword">typedef</span> <span class="token keyword">int</span><span class="token punctuation">(</span>ARRAY_TYPE<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
    <span class="token comment">//ARRAY_TYPE是一个数据类型，存放5个int元素的数组的类型</span>
    
	ARRAY_TYPE <span class="token operator">*</span> arrP <span class="token operator">=</span> <span class="token operator">&amp;</span>arr<span class="token punctuation">;</span> <span class="token comment">//arrP就是数组指针</span>
	<span class="token comment">//对数组指针解引用，就是数组名，</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">*</span>arrP<span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//*arrP=arr</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>arrP<span class="token punctuation">)</span><span class="token operator">+</span>i<span class="token punctuation">)</span>  <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//2、先定义数组指针的类型，再定义数组指针变量</span>
<span class="token keyword">void</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token keyword">typedef</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token operator">*</span>ARRAY_TYPE<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

	<span class="token comment">// *arrP 是 arr</span>
	ARRAY_TYPE arrP <span class="token operator">=</span> <span class="token operator">&amp;</span>arr<span class="token punctuation">;</span>

	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">*</span>arrP<span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>arrP<span class="token punctuation">)</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//3、直接定义数组指针变量</span>
<span class="token keyword">void</span> <span class="token function">test03</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token keyword">int</span><span class="token punctuation">(</span><span class="token operator">*</span>p<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span>  <span class="token operator">=</span> <span class="token operator">&amp;</span>arr<span class="token punctuation">;</span>

	<span class="token comment">//*p -&gt; arr</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">*</span>p<span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h3 id="_4-3-二维数组与数组名"><a href="#_4-3-二维数组与数组名" class="header-anchor">#</a> 4.3 二维数组与数组名</h3> <ul><li><p>二维数组名</p> <ul><li>二维数组名可以当成指向第一个一维数组的指针来使用</li> <li>对二维数组名sizeof 或者取地址除外</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>  
		<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token comment">//其它定义方式</span>
	<span class="token comment">//int arr2[3][3] = { 1, 2, 3, 4, 5, 6, 7, 8, 9 };</span>
	<span class="token comment">//int arr3[][3] = { 1, 2, 3, 4, 5, 6, 7, 8, 9 };</span>
	
    <span class="token comment">//定义一个数组指针指向第一个一维数组的首地址</span>
	<span class="token keyword">int</span><span class="token punctuation">(</span><span class="token operator">*</span>pArray<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">;</span>

	<span class="token comment">//三种方式访问同一个元素</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;arr[1][2] = %d\n&quot;</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;arr[1][2] = %d\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>pArray <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;arr[1][2] = %d\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">*</span>pArray <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>二维数组做函数参数</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token comment">//void printArray( int(*pArr)[3] ,int len1,int len2 )</span>
<span class="token comment">//void printArray(int pArr[][3], int len1, int len2)</span>
<span class="token keyword">void</span> <span class="token function">printArray</span><span class="token punctuation">(</span><span class="token keyword">int</span> pArr<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">int</span> len1<span class="token punctuation">,</span> <span class="token keyword">int</span> len2<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len1<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> len2<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token comment">//printf(&quot;%d &quot;, pArr[i][j]);</span>

			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d &quot;</span><span class="token punctuation">,</span>  <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>pArr <span class="token operator">+</span> i<span class="token punctuation">)</span> <span class="token operator">+</span> j<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//本质先是跳转行，解引用发后跳转列</span>
		<span class="token punctuation">}</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
		<span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span> <span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token keyword">int</span> row <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token operator">/</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> col <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printArray</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> row<span class="token punctuation">,</span> col<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//三个打印结果是一样的，区别在于，+1的步长不同</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h2 id="_5-结构体进阶"><a href="#_5-结构体进阶" class="header-anchor">#</a> 5. 结构体进阶</h2> <h3 id="_5-1-结构体的基本使用"><a href="#_5-1-结构体的基本使用" class="header-anchor">#</a> 5.1 结构体的基本使用</h3> <ul><li>结构体常见基本错误
<ul><li>结构体里面放函数，报错</li> <li>不要在做定义自定义数据类型时给其赋初值</li></ul></li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token comment">//定义一个结构体，类型为struct Preson</span>
<span class="token keyword">struct</span> <span class="token class-name">Preson</span>
<span class="token punctuation">{</span>
	<span class="token keyword">char</span> name<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> age<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//重命名struct Preson为myPreson</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">Preson</span> myPreson<span class="token punctuation">;</span>


<span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">//在栈上使用</span>
	myPreson p1 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">&quot;aaa&quot;</span><span class="token punctuation">,</span><span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;p1姓名：%s，年龄p1;%d\n&quot;</span><span class="token punctuation">,</span> p1<span class="token punctuation">.</span>name<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//在堆区使用</span>
	myPreson<span class="token operator">*</span> p2 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>myPreson<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">strcpy</span><span class="token punctuation">(</span>p2<span class="token operator">-&gt;</span>name<span class="token punctuation">,</span> <span class="token string">&quot;bbb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	p2<span class="token operator">-&gt;</span>age <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;p2姓名：%s，年龄p2;%d\n&quot;</span><span class="token punctuation">,</span> p2<span class="token operator">-&gt;</span>name<span class="token punctuation">,</span> p2<span class="token operator">-&gt;</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">free</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	p2 <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>结构体变量数组</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token comment">//先写一个打印函数</span>
<span class="token keyword">void</span> <span class="token function">printmyPreson</span><span class="token punctuation">(</span>myPreson arr<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> len<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;姓名： %s  , 年龄:  %d \n&quot;</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//结构体变量数组</span>
<span class="token keyword">void</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">//栈上分配内存</span>
	myPreson Arr<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span>
	<span class="token punctuation">{</span>
		<span class="token punctuation">{</span><span class="token string">&quot;aaa&quot;</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{</span><span class="token string">&quot;bbb&quot;</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{</span><span class="token string">&quot;ccc&quot;</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Arr<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>myPreson<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printmyPreson</span><span class="token punctuation">(</span>Arr<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//堆上分配内存</span>
	myPreson<span class="token operator">*</span> Arr2 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>myPreson<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//写入内容</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">sprintf</span><span class="token punctuation">(</span>Arr2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">&quot;name_%d&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
		Arr2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>age <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
    
	<span class="token function">printmyPreson</span><span class="token punctuation">(</span>Arr2<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">free</span><span class="token punctuation">(</span>Arr2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	Arr2 <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-2-结构体赋值问题"><a href="#_5-2-结构体赋值问题" class="header-anchor">#</a> 5.2 结构体赋值问题</h3> <ul><li><p>结构体不包含指针，可以直接用“=”赋值</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">Person</span>
<span class="token punctuation">{</span>
	<span class="token keyword">char</span> name<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> age<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">struct</span> <span class="token class-name">Person</span> p1 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">&quot;Tom&quot;</span><span class="token punctuation">,</span> <span class="token number">18</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token keyword">struct</span> <span class="token class-name">Person</span> p2 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">&quot;Jerry&quot;</span><span class="token punctuation">,</span> <span class="token number">20</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

	p1 <span class="token operator">=</span> p2<span class="token punctuation">;</span> <span class="token comment">//逐字节的进行拷贝</span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;P1 姓名 ： %s, 年龄： %d\n&quot;</span><span class="token punctuation">,</span> p1<span class="token punctuation">.</span>name<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;P2 姓名 ： %s, 年龄： %d\n&quot;</span><span class="token punctuation">,</span> p2<span class="token punctuation">.</span>name<span class="token punctuation">,</span> p2<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>结构体包含指针，仍使用“=”会报错</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">Person2</span>
<span class="token punctuation">{</span>
	<span class="token keyword">char</span> <span class="token operator">*</span> name<span class="token punctuation">;</span>
	<span class="token keyword">int</span> age<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">struct</span> <span class="token class-name">Person2</span> p1<span class="token punctuation">;</span>
	p1<span class="token punctuation">.</span>name <span class="token operator">=</span>  <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token operator">*</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">strcpy</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">&quot;Tom&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	p1<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>

	<span class="token keyword">struct</span> <span class="token class-name">Person2</span> p2<span class="token punctuation">;</span>
	p2<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token operator">*</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">strcpy</span><span class="token punctuation">(</span>p2<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">&quot;Jerry&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	p2<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
    <span class="token comment">//之所以不直接strcpy(p1.name, p2.name);</span>
    <span class="token comment">//因为p2.name比p1.name长，如果p1.name空间不够用就报错</span>
    
    <span class="token comment">//p1=p2   //报错</span>
	<span class="token comment">//解决方式  手动进行赋值操作</span>
	<span class="token comment">///////////////////////////////////</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>p1<span class="token punctuation">.</span>name<span class="token operator">!=</span><span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">free</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
		p1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	p1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span>p2<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">strcpy</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span>name<span class="token punctuation">,</span> p2<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

	p1<span class="token punctuation">.</span>age <span class="token operator">=</span> p2<span class="token punctuation">.</span>age<span class="token punctuation">;</span>

	<span class="token comment">////////////////////////////////////</span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;P1 姓名 ： %s  年龄： %d\n&quot;</span><span class="token punctuation">,</span> p1<span class="token punctuation">.</span>name<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;P2 姓名 ： %s, 年龄： %d\n&quot;</span><span class="token punctuation">,</span> p2<span class="token punctuation">.</span>name<span class="token punctuation">,</span> p2<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//堆区开辟的内容，手动释放</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>p1<span class="token punctuation">.</span>name <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">free</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
		p1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>p2<span class="token punctuation">.</span>name <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">free</span><span class="token punctuation">(</span>p2<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
		p2<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h3 id="_5-3-结构体偏移"><a href="#_5-3-结构体偏移" class="header-anchor">#</a> 5.3 结构体偏移</h3> <ul><li><p>作用：用于计算出结构体中属性相对于首地址的偏移量</p></li> <li><p>方法</p> <ul><li>直接把指针所指向的地址强转成int相减</li> <li>使用offsetof()宏函数</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stddef.h&gt;</span></span>

<span class="token keyword">struct</span> <span class="token class-name">Teacher</span>
<span class="token punctuation">{</span>
	<span class="token keyword">char</span> a<span class="token punctuation">;</span>
	<span class="token keyword">int</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

	<span class="token keyword">struct</span> <span class="token class-name">Teacher</span>  t1<span class="token punctuation">;</span>
	<span class="token keyword">struct</span> <span class="token class-name">Teacher</span><span class="token operator">*</span>p <span class="token operator">=</span> <span class="token operator">&amp;</span>t1<span class="token punctuation">;</span>

	<span class="token keyword">int</span> offsize1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>p<span class="token operator">-&gt;</span>b<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>p<span class="token punctuation">;</span> 
	<span class="token keyword">int</span> offsize2 <span class="token operator">=</span> <span class="token function">offsetof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">Teacher</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//打印b属性对于首地址的偏移量</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;offsize1:%d \n&quot;</span><span class="token punctuation">,</span> offsize1<span class="token punctuation">)</span><span class="token punctuation">;</span> 
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;offsize2:%d \n&quot;</span><span class="token punctuation">,</span> offsize2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//通过偏移量打印成员数据</span>
<span class="token keyword">void</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">struct</span> <span class="token class-name">Teacher</span> t <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token comment">//打印c2的数据</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;t.b = %d\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>t <span class="token operator">+</span> <span class="token function">offsetof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">Teacher</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;t.b = %d\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>t <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//结构体嵌套结构体计算偏移量的方法</span>
<span class="token keyword">struct</span> <span class="token class-name">Teacher2</span>
<span class="token punctuation">{</span>
	<span class="token keyword">char</span> a<span class="token punctuation">;</span>
	<span class="token keyword">int</span>  b<span class="token punctuation">;</span>
	<span class="token keyword">struct</span> <span class="token class-name">Teacher</span> c<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">test03</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">struct</span> <span class="token class-name">Teacher2</span> t <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token number">20</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token keyword">int</span> offset1 <span class="token operator">=</span> <span class="token function">offsetof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">Teacher2</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> offset2 <span class="token operator">=</span> <span class="token function">offsetof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">Teacher</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>t <span class="token operator">+</span> offset1<span class="token punctuation">)</span> <span class="token operator">+</span> offset2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">Teacher2</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>t <span class="token operator">+</span> offset1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h2 id="_6-文件操作"><a href="#_6-文件操作" class="header-anchor">#</a> 6. 文件操作</h2> <h3 id="_6-1-文件的简述"><a href="#_6-1-文件的简述" class="header-anchor">#</a> 6.1 文件的简述</h3> <ul><li>文件时数据源的一种，主要作用是保存数据，如word、txt、头文件、源文件、exe</li> <li>磁盘文件与设备文件
<ul><li>磁盘文件，计算机里的文件，不受断电的影响，存取速度相对于内存慢得多</li> <li>设备文件，操作系统中把每个与主机相连的输入、输出设备都看作是一个文件</li></ul></li> <li>磁盘文件的分类
<ul><li>文本文件
<ul><li>基于字符编码，常见的编码有ASCII、UNICODE等</li> <li>一般可以使用文本编辑器直接打开</li> <li>数字使用ASCII码存储，如567为00110101 00110110 00110111</li></ul></li> <li>二进制文件
<ul><li>基于值编码，自己根据具体应用，指定某个值是什么意思</li> <li>把内存中的数据按其在内存中的存储形式原样输出到磁盘上</li> <li>如数5678的存储形式(二进制码)为：00010110  00101110</li></ul></li></ul></li></ul> <h3 id="_6-2-文件指针"><a href="#_6-2-文件指针" class="header-anchor">#</a> 6.2 文件指针</h3> <ul><li><p>文件指针即建立程序与文件的联系</p> <ul><li>通过系统typedef定义出的有关文件信息的一种结构体类型FILE</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span>
<span class="token punctuation">{</span>
	<span class="token keyword">short</span>           level<span class="token punctuation">;</span>	<span class="token comment">//缓冲区&quot;满&quot;或者&quot;空&quot;的程度 </span>
	<span class="token keyword">unsigned</span>        flags<span class="token punctuation">;</span>	<span class="token comment">//文件状态标志 </span>
	<span class="token keyword">char</span>            fd<span class="token punctuation">;</span>		<span class="token comment">//文件描述符</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span>   hold<span class="token punctuation">;</span>	<span class="token comment">//如无缓冲区不读取字符</span>
	<span class="token keyword">short</span>           bsize<span class="token punctuation">;</span>	<span class="token comment">//缓冲区的大小</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span>   <span class="token operator">*</span>buffer<span class="token punctuation">;</span><span class="token comment">//数据缓冲区的位置 </span>
	<span class="token keyword">unsigned</span>        ar<span class="token punctuation">;</span>	 <span class="token comment">//指针，当前的指向 </span>
	<span class="token keyword">unsigned</span>        istemp<span class="token punctuation">;</span>	<span class="token comment">//临时文件，指示器</span>
	<span class="token keyword">short</span>           token<span class="token punctuation">;</span>	<span class="token comment">//用于有效性的检查 </span>
<span class="token punctuation">}</span>FILE<span class="token punctuation">;</span>
</code></pre></div></li></ul> <h3 id="_6-3-文件的开关"><a href="#_6-3-文件的开关" class="header-anchor">#</a> 6.3 文件的开关</h3> <ul><li><p>打开文件</p> <div class="language-c extra-class"><pre class="language-c"><code>FILE <span class="token operator">*</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>filename<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>mode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//char *filename为需要打开的文件名，不在同级目录需加路径</span>
<span class="token comment">//char *mode打开文件的模式</span>
<span class="token comment">//成功返回文件指针，失败返回NULL</span>
</code></pre></div></li></ul> <table><thead><tr><th>打开模式</th> <th>含义</th></tr></thead> <tbody><tr><td>r或rb</td> <td>以只读的方式打开，文件不存在则报错</td></tr> <tr><td>w或wb</td> <td>以写入的方式打开，文件存在则清空文件，不存在则创建一个空文件</td></tr> <tr><td>a或ab</td> <td>以追加的方式打开文件，在末尾添加内容，不存在则创建一个空文件</td></tr> <tr><td>r+或rb+</td> <td>以可读、可写的方式打开文件（但不创建）</td></tr> <tr><td>w+或wb+</td> <td>以可读、可写的方式，文件存在则清空文件，不存在则创建一个空文件</td></tr> <tr><td>a+或ab+</td> <td>以添加方式打开文件，并在末尾更改文件，若文件不存在则创建文件</td></tr> <tr><td>注：</td> <td>b即二进制的意思，只在windows下有效，Linux的都一样</td></tr></tbody></table> <ul><li><p>关闭文件</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">fclose</span><span class="token punctuation">(</span>FILE <span class="token operator">*</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//fp为指向被打开的文件的指针</span>
<span class="token comment">//成功返回0，失败返回EOF</span>
</code></pre></div><ul><li>打开的文件会占用内存资源，一个进程同时打开的文件数是有限制的</li> <li>不调用close()进行关闭，系统会在退出时统一关闭</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	FILE<span class="token operator">*</span> fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">&quot;test01.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;w&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//打开</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>fp <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">pritnf</span><span class="token punctuation">(</span><span class="token string">&quot;打开失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//关闭</span>
	
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>EOF为文件结束标志，符号常量值为-1，用于判断文件是否读到末尾</p></li> <li><p>文本文件和二进制文件换行符不同，前者文件大小比后者大1字节</p> <ul><li>文本文件为\r\n，r即return回车键，n为newline</li> <li>二进制文件为\n</li></ul></li></ul> <h3 id="_6-4-按字符、行读写"><a href="#_6-4-按字符、行读写" class="header-anchor">#</a> 6.4 按字符、行读写</h3> <ul><li><p>按字符读写</p> <ul><li>fputc()，即file put char</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">fputc</span><span class="token punctuation">(</span><span class="token keyword">int</span> ch<span class="token punctuation">,</span> FILE <span class="token operator">*</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//写文件</span>
<span class="token comment">//写入一个字符ch入stream指向的文件中</span>
<span class="token comment">//写入成功返回写入的字符的ASCII码值，失败返回EOF</span>
</code></pre></div><div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	FILE<span class="token operator">*</span> fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">&quot;test02.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;w&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>fp <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;打开失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;hello\n&quot;</span><span class="token punctuation">;</span>  <span class="token comment">//先定义一个内容字符串</span>
	<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment">//逐个写入，用while</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">int</span> ret <span class="token operator">=</span><span class="token function">fputc</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
		i<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token comment">//printf(&quot;%c&quot;,ret);</span>
	<span class="token punctuation">}</span>

	<span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>fgetc()，即file get char</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">fgetc</span><span class="token punctuation">(</span>FILE <span class="token operator">*</span> stream<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//读文件</span>
<span class="token comment">//从stream逐个读取字符</span>
<span class="token comment">//成功返回被读取的字符的ASCII码值，失败返回EOF</span>
</code></pre></div><div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">test03</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	FILE<span class="token operator">*</span> fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">&quot;test02.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;r&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>fp <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;打开失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">//先定义一个字符串用于存储</span>
	<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment">//逐个读取，用while</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">fgetc</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token constant">EOF</span><span class="token punctuation">)</span>          
	<span class="token punctuation">{</span>
		i<span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s&quot;</span><span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>按行读写</p> <ul><li>fputs()，即file put string
<ul><li>向指定的文件写入一个字符串，不自动写入‘\0’</li></ul></li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">fputs</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>str<span class="token punctuation">,</span> FILE <span class="token operator">*</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//写文件</span>
<span class="token comment">//str为待写入的字符串</span>
<span class="token comment">//stream为被写入的文件指针</span>
<span class="token comment">//成功返回非负整数，否则返回EOF</span>
</code></pre></div><div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//字符串数组，里面都是字符串，要用指针数组变量来存</span>
	<span class="token keyword">char</span><span class="token operator">*</span> buf<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
		<span class="token string">&quot;鹅鹅鹅，\n&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;曲项向天歌。\n&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;白毛浮绿水，\n&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;红掌拨清波。\n&quot;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	FILE<span class="token operator">*</span> fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">&quot;《咏鹅》.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;w&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>fp <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;打开失败\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">fputs</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>fgets()，即file get string
<ul><li>从指定的流中读取数据，每次读取一行</li> <li>执行一次光标停顿一次，下次执行从上次执行完的位置继续</li></ul></li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">fgets</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>str<span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">,</span> FILE <span class="token operator">*</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//char *str为准备接受所读取数据的字符串</span>
<span class="token comment">//int size为读取的最大字符数（包括最后的空字符）</span>
<span class="token comment">//FILE *stream为指向FILE对象的指针</span>
<span class="token comment">//成功返回相同的str地址值，失败返回NULL</span>
</code></pre></div><div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	FILE<span class="token operator">*</span> fp <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">&quot;《咏鹅》.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;r&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>fp <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;打开失败\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    
	<span class="token comment">//下次执行从上次执行完的位置继续</span>
    
	<span class="token comment">//int ret =fgets(buf, sizeof(buf), fp);</span>
	<span class="token comment">//printf(&quot;%s\n&quot;, buf);</span>
	<span class="token comment">//printf(&quot;%d %d\n&quot;, ret, buf);</span>
	<span class="token comment">//fgets(buf, sizeof(buf), fp);</span>
	<span class="token comment">//printf(&quot;%s\n&quot;, buf);</span>
	
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">fgets</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">,</span> fp<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token comment">//去除原有写入的换行符</span>
		buf<span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'\0'</span><span class="token punctuation">;</span>
		<span class="token comment">//strlen()计算指定指定字符串s的长度，到\0结束，且不包含\0</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s\n&quot;</span><span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>项目练习</p> <ul><li>四则运算出题50题，写入一个txt，数字符号随机</li> <li>读取所出题目解题并将答案写入另一个txt</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property">#<span class="token directive keyword">define</span> _CRT_SECURE_NO_WARNINGS</span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;stddef.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;time.h&gt;</span></span>

<span class="token keyword">void</span> <span class="token function">setQuestion</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">srand</span><span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> num1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> num2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">char</span> oper<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">'+'</span><span class="token punctuation">,</span><span class="token string">'-'</span><span class="token punctuation">,</span><span class="token string">'*'</span><span class="token punctuation">,</span><span class="token string">'/'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">char</span> ch <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

	FILE<span class="token operator">*</span> fp <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">&quot;写入题目.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;w&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>fp <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;打开失败\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		num1 <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">100</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
		num2 <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">100</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
		ch <span class="token operator">=</span> oper<span class="token punctuation">[</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

		<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
		<span class="token function">sprintf</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token string">&quot;%d%c%d=\n&quot;</span><span class="token punctuation">,</span> num1<span class="token punctuation">,</span> ch<span class="token punctuation">,</span> num2<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">fputs</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
	<span class="token punctuation">}</span>
	<span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">answerQuestion</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	FILE<span class="token operator">*</span> fp1 <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">&quot;写入题目.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;r&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	FILE<span class="token operator">*</span> fp2 <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">&quot;题目答案.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;w&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">char</span> str<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">char</span> str2<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">int</span> num1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> num2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
		<span class="token keyword">int</span> num3 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">char</span> oper <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token function">fgets</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span><span class="token number">1024</span> <span class="token punctuation">,</span>fp1<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">sscanf</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token string">&quot;%d%c%d=&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>num1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>oper<span class="token punctuation">,</span> <span class="token operator">&amp;</span>num2<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>oper <span class="token operator">==</span> <span class="token string">'+'</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			num3 <span class="token operator">=</span> num1 <span class="token operator">+</span> num2<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>oper <span class="token operator">==</span> <span class="token string">'-'</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			num3 <span class="token operator">=</span> num1 <span class="token operator">-</span> num2<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>oper <span class="token operator">==</span> <span class="token string">'*'</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			num3 <span class="token operator">=</span> num1 <span class="token operator">*</span> num2<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> 
		<span class="token punctuation">{</span>			
			num3 <span class="token operator">=</span> num1 <span class="token operator">/</span> num2<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token function">sprintf</span><span class="token punctuation">(</span>str2<span class="token punctuation">,</span> <span class="token string">&quot;%d%c%d=%d\n&quot;</span><span class="token punctuation">,</span> num1<span class="token punctuation">,</span> oper<span class="token punctuation">,</span> num2<span class="token punctuation">,</span> num3<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">fputs</span><span class="token punctuation">(</span>str2<span class="token punctuation">,</span> fp2<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
	<span class="token punctuation">}</span>
	<span class="token function">fclose</span><span class="token punctuation">(</span>fp1<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">fclose</span><span class="token punctuation">(</span>fp2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">setQuestion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">answerQuestion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h3 id="_6-5-按格式化、按块读写"><a href="#_6-5-按格式化、按块读写" class="header-anchor">#</a> 6.5 按格式化、按块读写</h3> <ul><li><p>按格式化方式读写</p> <ul><li>fprintf()写文件</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">fprintf</span><span class="token punctuation">(</span>FILE <span class="token operator">*</span> stream<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> format<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//stream为指向被打开的文件的指针</span>
<span class="token comment">//format为格式</span>
<span class="token comment">//...为待写入的数据的变量的地址</span>
<span class="token comment">//成功返回写入文件的字节数，失败返回负数</span>
</code></pre></div><div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">Hero</span>
<span class="token punctuation">{</span>
	<span class="token keyword">char</span> name<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> atk<span class="token punctuation">;</span>
	<span class="token keyword">int</span> def<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">struct</span> <span class="token class-name">Hero</span> heros<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token punctuation">{</span> <span class="token string">&quot;亚瑟&quot;</span><span class="token punctuation">,</span><span class="token number">110</span><span class="token punctuation">,</span> <span class="token number">200</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span> <span class="token string">&quot;赵云&quot;</span><span class="token punctuation">,</span><span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">150</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span> <span class="token string">&quot;韩信&quot;</span><span class="token punctuation">,</span><span class="token number">170</span><span class="token punctuation">,</span> <span class="token number">130</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span> <span class="token string">&quot;蔡文姬&quot;</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">180</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span> <span class="token string">&quot;斧头帮帮主&quot;</span><span class="token punctuation">,</span><span class="token number">999</span><span class="token punctuation">,</span> <span class="token number">999</span> <span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

	FILE<span class="token operator">*</span> fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">&quot;heros.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;wb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>fp <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;文件打开失败\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>heros<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">Hero</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token comment">//1个中文两个字节</span>
		<span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token function">fprintf</span><span class="token punctuation">(</span>fp<span class="token punctuation">,</span> <span class="token string">&quot;%s %d %d\n&quot;</span><span class="token punctuation">,</span> heros<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> heros<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>atk<span class="token punctuation">,</span> heros<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>def<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//printf(&quot;第%d行写入字节数：%d\n&quot;, i + 1, len);//返回写入字符的字节数</span>
	<span class="token punctuation">}</span>

	<span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><ul><li>fscanf()读文件
<ul><li>从指定的流中格式化读取数据，每次读取一行</li> <li>执行一次光标停顿一次，下次执行从上次执行完的位置继续</li></ul></li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">fscanf</span><span class="token punctuation">(</span>FILE <span class="token operator">*</span> stream<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> format<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//stream为指向被打开的文件的指针</span>
<span class="token comment">//format为格式</span>
<span class="token comment">//...为待接收数据的变量的地址</span>
<span class="token comment">//成功返回文件成功写入的变量个数，失败返回EOF</span>
</code></pre></div><div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	FILE<span class="token operator">*</span> fp2 <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">&quot;heros.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;rb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>fp2 <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;打开失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">struct</span> <span class="token class-name">Hero</span> get_heros<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	
	<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">fscanf</span><span class="token punctuation">(</span>fp2<span class="token punctuation">,</span> <span class="token string">&quot;%s %d %d&quot;</span><span class="token punctuation">,</span> get_heros<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token operator">&amp;</span>get_heros<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>atk<span class="token punctuation">,</span> <span class="token operator">&amp;</span>get_heros<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>def<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//与写入函数scanf、write有关的都要注意&amp;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s %d %d\n&quot;</span><span class="token punctuation">,</span> get_heros<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> get_heros<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>atk<span class="token punctuation">,</span> get_heros<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>def<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">fclose</span><span class="token punctuation">(</span>fp2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div></li> <li><p>按块读写</p> <ul><li>fwrite()，写文件
<ul><li>写入的是整个结构体数据</li></ul></li></ul> <div class="language-c extra-class"><pre class="language-c"><code>size_t <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">,</span> size_t size<span class="token punctuation">,</span> size_t nmemb<span class="token punctuation">,</span> FILE <span class="token operator">*</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//ptr写入数据的地址</span>
<span class="token comment">//size块大小</span>
<span class="token comment">//nmemb块数量</span>
<span class="token comment">//stream文件指针</span>
</code></pre></div><div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">Hero</span><span class="token punctuation">{</span>
	<span class="token keyword">char</span> name<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> age<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	FILE<span class="token operator">*</span> fp1 <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">&quot;Hero.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;wb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//用二进制的方式写入</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>fp1 <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;打开失败\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">struct</span> <span class="token class-name">Hero</span> heros<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span>
	<span class="token punctuation">{</span>
		<span class="token punctuation">{</span><span class="token string">&quot;风男&quot;</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{</span><span class="token string">&quot;瞎子&quot;</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{</span><span class="token string">&quot;盖伦&quot;</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token comment">//打印一下初始数据</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;name：%s  age：%d\n&quot;</span><span class="token punctuation">,</span> heros<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> heros<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;---------------------\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">fwrite</span><span class="token punctuation">(</span>heros<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">Hero</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> fp1<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">fclose</span><span class="token punctuation">(</span>fp1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>fread()，读文件
<ul><li>读取的是整个结构体数据</li></ul></li></ul> <div class="language-c extra-class"><pre class="language-c"><code>size_t <span class="token function">fread</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">,</span> size_t size<span class="token punctuation">,</span> size_t nmemb<span class="token punctuation">,</span> FILE <span class="token operator">*</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//ptr待写入数据的地址</span>
<span class="token comment">//size块大小</span>
<span class="token comment">//nmemb块数量</span>
<span class="token comment">//stream文件指针</span>
</code></pre></div><div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	FILE<span class="token operator">*</span> fp2 <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">&quot;Hero.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;rb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//用二进制的方式打开</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>fp2 <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;打开失败\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">struct</span> <span class="token class-name">Hero</span> heros2<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

	<span class="token function">fread</span><span class="token punctuation">(</span>heros2<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">Hero</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> fp2<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;name2：%s  age2：%d\n&quot;</span><span class="token punctuation">,</span> heros2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> heros2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">fclose</span><span class="token punctuation">(</span>fp2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>操作练习</p> <ul><li>生成100个1-1000随机数，写入文件</li> <li>读取文件的100个随机数，排序后存入另一个文件</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property">#<span class="token directive keyword">define</span> _CRT_SECURE_NO_WARNINGS</span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;stddef.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;time.h&gt;</span></span>

<span class="token comment">//生成一个有100个随机数的txt文件</span>
<span class="token keyword">void</span> <span class="token function">randomFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">srand</span><span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	FILE<span class="token operator">*</span> fp1 <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">&quot;100个随机数.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;w&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>fp1 <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;fp1打开失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>


	<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">1000</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token function">fprintf</span><span class="token punctuation">(</span>fp1<span class="token punctuation">,</span> <span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">fclose</span><span class="token punctuation">(</span>fp1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span>  <span class="token function">baboSort</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token operator">*</span>ar<span class="token punctuation">,</span> <span class="token keyword">int</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">sortFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	FILE<span class="token operator">*</span> fp2 <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">&quot;100个随机数.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;r&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	FILE<span class="token operator">*</span> fp3 <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">&quot;排好序.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;w&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>fp2 <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;fp21打开失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>fp3 <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;fp3打开失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">fscanf</span><span class="token punctuation">(</span>fp2<span class="token punctuation">,</span> <span class="token string">&quot;%d&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token punctuation">}</span>

	<span class="token comment">/*for (size_t i = 0; i &lt; 100; i++)
	{
		printf(&quot;%d\n&quot;, arr[i]);

	}*/</span>

	<span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">baboSort</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">fprintf</span><span class="token punctuation">(</span>fp3<span class="token punctuation">,</span> <span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	

	<span class="token function">fclose</span><span class="token punctuation">(</span>fp2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">fclose</span><span class="token punctuation">(</span>fp3<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//冒泡排序</span>
<span class="token keyword">int</span>  <span class="token function">baboSort</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token operator">*</span>ar<span class="token punctuation">,</span><span class="token keyword">int</span> len<span class="token punctuation">)</span>  <span class="token comment">//使用高级指针</span>
<span class="token punctuation">{</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> len<span class="token operator">-</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			
			<span class="token keyword">if</span> <span class="token punctuation">(</span>ar<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&gt;</span> ar<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
			<span class="token punctuation">{</span>
				<span class="token keyword">int</span> temp <span class="token operator">=</span> ar<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
				ar<span class="token punctuation">[</span>j <span class="token punctuation">]</span> <span class="token operator">=</span> ar<span class="token punctuation">[</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
				ar<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">;</span>

			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> ar<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">randomFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">sortFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h3 id="_6-6-文件指针"><a href="#_6-6-文件指针" class="header-anchor">#</a> 6.6 文件指针</h3> <ul><li><p>主要有三个</p> <ul><li>rewind()，把文件流（文件光标）的读写位置移动到文件开头</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">rewind</span><span class="token punctuation">(</span>FILE <span class="token operator">*</span>stream <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>fseek()，移动文件流（文件光标）的读写位置</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">fseek</span><span class="token punctuation">(</span>FILE <span class="token operator">*</span>stream<span class="token punctuation">,</span> <span class="token keyword">long</span> offset<span class="token punctuation">,</span> <span class="token keyword">int</span> fromwhere<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//stream</span>
<span class="token comment">//offset移动的字节数</span>
<span class="token comment">//fromwhere的取值为：</span>
<span class="token comment">//SEEK_SET：从文件开头移动offset个字节</span>
<span class="token comment">//SEEK_CUR：从当前位置移动offset个字节</span>
<span class="token comment">//SEEK_END：从文件末尾移动offset个字节</span>
<span class="token comment">//成功返回0，失败返回非0值</span>
</code></pre></div><ul><li>ftell()， 获取文件流（文件光标）的读写位置</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">long</span> <span class="token function">ftell</span><span class="token punctuation">(</span>FILE <span class="token operator">*</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//stream</span>
<span class="token comment">//成功返回光标从起止位置偏移的字节数，失败返回-1</span>
<span class="token comment">//由于long的取值范围，文件大小大于2.1g时会失败</span>
</code></pre></div></li> <li><p>相关操作练习</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">hero</span> <span class="token punctuation">{</span>
	<span class="token keyword">char</span> name<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> age<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">struct</span> <span class="token class-name">hero</span> heros<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span>
	<span class="token punctuation">{</span>
		<span class="token punctuation">{</span><span class="token string">&quot;压缩&quot;</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{</span><span class="token string">&quot;瑞文&quot;</span><span class="token punctuation">,</span><span class="token number">19</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{</span><span class="token string">&quot;猴子&quot;</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

	FILE<span class="token operator">*</span> fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">&quot;heros.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;wb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>fp <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;open fail\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">fwrite</span><span class="token punctuation">(</span>heros<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">hero</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>

	FILE<span class="token operator">*</span> file_read <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	file_read <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">&quot;heros.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;rb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>file_read <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> 
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;open fail\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>


	<span class="token comment">//创建临时的结构体 </span>
	<span class="token keyword">struct</span> <span class="token class-name">hero</span> temp<span class="token punctuation">;</span>
	<span class="token comment">//读文件  移动到第三个结构体位置</span>
	<span class="token function">fseek</span><span class="token punctuation">(</span>file_read<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">hero</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token constant">SEEK_SET</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//SEEK_SET从文件开始移动</span>
	<span class="token function">fread</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>temp<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">hero</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> file_read<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Name:%s Age:%d\n&quot;</span><span class="token punctuation">,</span> temp<span class="token punctuation">.</span>name<span class="token punctuation">,</span> temp<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>temp<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">hero</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//从末尾往前移动，使用负数步长，但sizsof()返回值为无符号数，所以强转再加符号</span>
	<span class="token function">fseek</span><span class="token punctuation">(</span>file_read<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">hero</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token constant">SEEK_END</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//SEEK_END从文件末尾移动</span>
	<span class="token function">fread</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>temp<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">hero</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> file_read<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Name:%s Age:%d\n&quot;</span><span class="token punctuation">,</span> temp<span class="token punctuation">.</span>name<span class="token punctuation">,</span> temp<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">rewind</span><span class="token punctuation">(</span>file_read<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//把文件流（文件光标）的读写位置移动到文件开头，读第一个结构体</span>
	<span class="token function">fread</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>temp<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">hero</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> file_read<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Name:%s Age:%d\n&quot;</span><span class="token punctuation">,</span> temp<span class="token punctuation">.</span>name<span class="token punctuation">,</span> temp<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">fclose</span><span class="token punctuation">(</span>file_read<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h2 id="_7-函数指针"><a href="#_7-函数指针" class="header-anchor">#</a> 7. 函数指针</h2> <h3 id="_7-1-函数指针的定义"><a href="#_7-1-函数指针的定义" class="header-anchor">#</a> 7.1 函数指针的定义</h3> <ul><li><p>三种方式</p> <ul><li>先定义函数类型，通过函数类型定义函数指针变量</li> <li>先定义函数指针类型，再通过函数指针类型定义函数指针变量</li> <li>直接定义函数指针变量</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span><span class="token keyword">char</span> b<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;hello\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    
	<span class="token keyword">typedef</span> <span class="token keyword">void</span><span class="token punctuation">(</span>myFunc<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	myFunc<span class="token operator">*</span> p <span class="token operator">=</span> func<span class="token punctuation">;</span>
	<span class="token function">p</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">typedef</span> <span class="token keyword">void</span><span class="token punctuation">(</span><span class="token operator">*</span> myFunc2<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	myFunc2 p2 <span class="token operator">=</span> func<span class="token punctuation">;</span>
	<span class="token function">p2</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>p3<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token operator">=</span> func<span class="token punctuation">;</span>
	<span class="token function">p3</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h3 id="_7-2-函数指针数组"><a href="#_7-2-函数指针数组" class="header-anchor">#</a> 7.2 函数指针数组</h3> <ul><li><p>区分函数指针和指针函数</p> <ul><li>函数指针是一个指向函数入口地址的指针</li> <li>指针函数是返回值为指针的函数</li></ul></li> <li><p>函数指针数组</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">func1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;func1调用\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;func2调用\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">func3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;func3调用\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//返回值类型都是void，形参都是空，可以整合成为一个数组</span>
<span class="token keyword">void</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">void</span><span class="token punctuation">(</span><span class="token operator">*</span>funcArr<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//语法要求[3]写数组名后</span>
	funcArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> func1<span class="token punctuation">;</span>
	funcArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> func2<span class="token punctuation">;</span>
	funcArr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> func3<span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		funcArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h3 id="_8-3-回调函数"><a href="#_8-3-回调函数" class="header-anchor">#</a> 8.3 回调函数</h3> <ul><li><p>函数指针做函数参数，利用函数指针调用所指的函数时，称为回调函数</p> <ul><li>提供一个函数，用户可以自定义回调函数打印任何类型的数组</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property">#<span class="token directive keyword">define</span> _CRT_SECURE_NO_WARNINGS</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;math.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;time.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;Windows.h&gt;</span></span>

<span class="token keyword">void</span> <span class="token function">myPrint</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span>arr<span class="token punctuation">,</span> <span class="token keyword">int</span> eleSize<span class="token punctuation">,</span> <span class="token keyword">int</span> len<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>setPrint<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">char</span><span class="token operator">*</span> p <span class="token operator">=</span> arr<span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">setPrint</span><span class="token punctuation">(</span>p <span class="token operator">+</span> eleSize <span class="token operator">*</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
<span class="token punctuation">}</span>

<span class="token function">myPrintIntArr</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> data<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span><span class="token operator">*</span> num <span class="token operator">=</span> data<span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">*</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">myPrint</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">,</span> len<span class="token punctuation">,</span> myPrintIntArr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token class-name">stu</span> <span class="token punctuation">{</span>
	<span class="token keyword">char</span> name<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> age<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">myPrintStudenArr</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> data<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">struct</span> <span class="token class-name">stu</span><span class="token operator">*</span> p <span class="token operator">=</span> data<span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;name:%s  age:%d\n&quot;</span><span class="token punctuation">,</span> p<span class="token operator">-&gt;</span>name<span class="token punctuation">,</span> p<span class="token operator">-&gt;</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">struct</span> <span class="token class-name">stu</span> studenArr<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span>
	<span class="token punctuation">{</span>
		<span class="token punctuation">{</span><span class="token string">&quot;loly&quot;</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{</span><span class="token string">&quot;pretty&quot;</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{</span><span class="token string">&quot;beuty&quot;</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">}</span>

	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>studenArr<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">stu</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">myPrint</span><span class="token punctuation">(</span>studenArr<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">stu</span><span class="token punctuation">)</span><span class="token punctuation">,</span> len<span class="token punctuation">,</span> myPrintStudenArr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">&quot;pause&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> EXIT_SUCCESS<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>操作练习1</p> <ul><li>提供一个函数，可以对任意类型的数组查找元素是否包含</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">myFind</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>arr<span class="token punctuation">,</span> <span class="token keyword">int</span> eleSize<span class="token punctuation">,</span> <span class="token keyword">int</span> len<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>myFunc<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">void</span><span class="token operator">*</span>data<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">char</span><span class="token operator">*</span> p <span class="token operator">=</span> arr<span class="token punctuation">;</span>
	<span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    
	<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		ret<span class="token operator">=</span><span class="token function">myFunc</span><span class="token punctuation">(</span>p <span class="token operator">+</span> eleSize <span class="token operator">*</span> i<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
		sum <span class="token operator">+=</span> ret<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>sum <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;找到了\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;无\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">theFind</span><span class="token punctuation">(</span>data1<span class="token punctuation">,</span>data2<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span><span class="token operator">*</span> num1 <span class="token operator">=</span> data1<span class="token punctuation">;</span>
	<span class="token keyword">int</span><span class="token operator">*</span> num2 <span class="token operator">=</span> data2<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>num1 <span class="token operator">==</span> <span class="token operator">*</span>num2<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">test03</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
	<span class="token function">myFind</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">,</span> len<span class="token punctuation">,</span> theFind<span class="token punctuation">,</span><span class="token operator">&amp;</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>操作练习2</p> <ul><li>提供一个函数，可以对任意类型的数组进行排序</li> <li>排序的序列由用户决定</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">myCompear</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> eleSize<span class="token punctuation">,</span> <span class="token keyword">int</span> len<span class="token punctuation">,</span><span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>mySort<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">,</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	
	<span class="token keyword">char</span><span class="token operator">*</span> temp<span class="token operator">=</span>	<span class="token function">malloc</span><span class="token punctuation">(</span>eleSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">char</span><span class="token operator">*</span> p <span class="token operator">=</span> arr<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>temp <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;申请失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> 
	<span class="token punctuation">{</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> len <span class="token operator">-</span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token keyword">char</span><span class="token operator">*</span> num1 <span class="token operator">=</span> p<span class="token operator">+</span> eleSize <span class="token operator">*</span> j <span class="token operator">+</span> eleSize<span class="token punctuation">;</span>
			<span class="token keyword">char</span><span class="token operator">*</span> num2 <span class="token operator">=</span> p <span class="token operator">+</span> eleSize <span class="token operator">*</span> j<span class="token punctuation">;</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">mySort</span><span class="token punctuation">(</span>num1<span class="token punctuation">,</span> num2<span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">{</span>
				<span class="token function">memcpy</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span> num1<span class="token punctuation">,</span> eleSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">memcpy</span><span class="token punctuation">(</span>num1<span class="token punctuation">,</span> num2<span class="token punctuation">,</span> eleSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">memcpy</span><span class="token punctuation">(</span>num2<span class="token punctuation">,</span> temp<span class="token punctuation">,</span> eleSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>temp <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">free</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>
		temp <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">sortData</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span>data1<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token operator">*</span>data2<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> <span class="token operator">*</span>a1 <span class="token operator">=</span> data1<span class="token punctuation">;</span>
	<span class="token keyword">int</span> <span class="token operator">*</span>a2 <span class="token operator">=</span> data2<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>a1<span class="token operator">&gt;</span> <span class="token operator">*</span> a2 <span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
		
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">myCompear</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">,</span> len<span class="token punctuation">,</span> sortData<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.21054e1e.js" defer></script><script src="/assets/js/2.331c82e1.js" defer></script><script src="/assets/js/7.b0b60adb.js" defer></script>
  </body>
</html>
